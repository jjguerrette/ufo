Assign constant observation error value:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 100000, 90000, 80000, 90000, 100000]
  station_id: [ 1, 1, 1, 1, 1]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error parameter: 1.2
  expected_obserror: [1.2, 1.2, 1.2, 1.2, 1.2]

# Tests using the NetCDF backend

Assign observation error from NetCDF variance; 1 exact; 1 linear (along the first axis):
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 2, 4, 6, 8, 10]
  observation_type: [0, 1, 2, 3, 4]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance.nc
          interpolation:
          - name: observation_type@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: linear
  expected_obserror_variance: [375.5, 601, 242.5, 175, 337]
Assign observation error from NetCDF variance; 1 nearest; 1 linear (along the second axis):
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -6, -6, -6, -4 ]
        lons: [ 30, 35, 40, 45 ]
        dateTimes: [ 0,
                     0,
                     0,
                     0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_latitude_longitude.nc
          interpolation:
          - name: latitude@MetaData
            method: nearest
          - name: longitude@MetaData
            method: linear
  expected_obserror_variance: [1, 1.5, 2, 5.5]
Assign observation error from NetCDF variance; 1 exact; 1 nearest:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 1, 2, 4, 13, 35]
  observation_type: [0, 1, 2, 3, 4]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance.nc
          interpolation:
          - name: observation_type@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: nearest
  expected_obserror_variance: [278, 755, 397, 846, 676]
Assign observation error from NetCDF full matrix; 3 exact; 1 nearest:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  channel_number:    [ 0, 1,  2, 3,  4 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr.nc
          interpolation:
          - name: channel_number@MetaData
            method: exact
          - name: satellite_id@MetaData
            method: exact
          - name: processing_center@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
  expected_obserror_variance: [685, 431, 771, 25, 805]
Assign observation error from NetCDF full matrix; 3 exact; 1 nearest; demonstrating yaml order respected with sorting:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  channel_number:    [ 0, 1,  2, 3,  4 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr.nc
          interpolation:
          - name: processing_center@MetaData
            method: exact
          - name: satellite_id@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
          - name: channel_number@MetaData
            method: exact
  expected_obserror_variance: [685, 431, 771, 25, 805]
Assign observation error from NetCDF full matrix with ioda-v2-style variable names; 3 exact; 1 nearest; demonstrating yaml order respected with sorting:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  channel_number:    [ 0, 1,  2, 3,  4 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr_v2.nc
          interpolation:
          - name: processing_center@MetaData
            method: exact
          - name: satellite_id@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
          - name: channel_number@MetaData
            method: exact
  expected_obserror_variance: [685, 431, 771, 25, 805]
Assign observation error from NetCDF full matrix 2D; 1 exact:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
      obs errors: [1.0]
  channel_number:    [ 2, 0, 4, 7, 5 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_2d_fullr.nc
          interpolation:
          - name: channel_number@MetaData
            method: exact
  expected_obserror_variance: [88, 685, 798, 618, 544]
Assign observation error from NetCDF variance; 3 exact (1 string, 1 datetime):
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: exact
          - name: dateTime@MetaData
            method: exact
  expected_obserror_variance: [278, 487, 917, 178, 289]
  Assign observation error from NetCDF file; data types float, int and string; missing values:
    window begin: 2000-01-01T00:00:00Z
    window end: 2030-01-01T00:00:00Z
    obs space:
      name: Aircraft
      simulated variables: [air_temperature]
      generate:
        list:
          lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
          lons: [ 30, 60, 30, 60, 30, 60, 30, 60 ]
          dateTimes: [ 0, 0,
                       0, 0,
                       0, 0,
                       0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
        obs errors: [1.0]
    air_pressure: [1000, 1000, 100000, 100000, 1000, 1000, 100000, 100000]
    StringVar: [south, south, south, south, north, north, north, north]
    ObsError assign:
      filter variables:
      - name: air_temperature
      action:
        name: assign error
        error function:
          name: DrawObsErrorFromFile@ObsFunction
          options:
            file: Data/ufo/testinput_tier_1/obserror_stringvar_pressure_longitude_missing_values.nc
            interpolation:
            - name: StringVar@MetaData
              method: exact
            - name: air_pressure@MetaData
              method: exact
            - name: longitude@MetaData
              method: exact
    expected_obserror_variance: [1, 2, 3, 4, 5, 6, 7, 8]
Assign observation error from NetCDF variance; attempt at using 'nearest' for strings:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: nearest
  expectExceptionWithMessage: The 'nearest' method cannot be used for string variables
Assign observation error from NetCDF variance; attempt at using 'linear' for strings:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: air_pressure@MetaData
            method: exact
          - name: StringVar@MetaData
            method: linear
  expectExceptionWithMessage: Linear interpolation cannot be performed along coordinate axes indexed by string variables such as MetaData/StringVar
Assign observation error from NetCDF variance; 1 least upper bound; 1 exact:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 300, 300, 300, 301, 301, 301]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: least upper bound
          - name: station_id@MetaData
            method: exact
  expected_obserror_variance: [1, 2, 3, 4, 5, 6]
Assign observation error from NetCDF variance; 1 greatest lower bound; 1 exact:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 599, 599, 599, 600, 600, 600]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: greatest lower bound
          - name: station_id@MetaData
            method: exact
  expected_obserror_variance: [1, 2, 3, 4, 5, 6]
Assign observation error from NetCDF variance; no match found for an 'exact' variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 2, 4, 6, 8, 10]
  observation_type: [1000, 1, 2, 3, 4]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance.nc
          interpolation:
          - name: observation_type@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: linear
  expectExceptionWithMessage: No match found for exact match extraction of value '1000' of the variable 'MetaData/observation_type'
Assign observation error from NetCDF variance; no match found for a 'least upper bound' variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [-99999, 300, 99999, 301, 301, 301]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: least upper bound
          - name: station_id@MetaData
            method: exact
  expectExceptionWithMessage: No match found for 'least upper bound' extraction of value '99999' of the variable 'MetaData/air_pressure'
Assign observation error from NetCDF variance; no match found for a 'greatest lower bound' variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [99999, 599, -99999, 600, 600, 600]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_lower_upper_bounds.nc
          interpolation:
          - name: air_pressure@MetaData
            method: greatest lower bound
          - name: station_id@MetaData
            method: exact
  expectExceptionWithMessage: No match found for 'greatest lower bound' extraction of value '-99999' of the variable 'MetaData/air_pressure'
Assign observation error from NetCDF variance; attempt to use the 'least upper bound' mode for a string variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: least upper bound
  expectExceptionWithMessage: The 'least upper bound' method cannot be used for string variables
Assign observation error from NetCDF variance; attempt to use the 'greatest lower bound' mode for a string variable:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [2, 4, 6, 8, 9]
  StringVar: ['aaa', 'aaa', 'bbb', 'ccc', 'ccc']
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_extract_variance_alt.nc
          interpolation:
          - name: StringVar@MetaData
            method: greatest lower bound
  expectExceptionWithMessage: The 'greatest lower bound' method cannot be used for string variables
Assign observation error from NetCDF file; no variable with the @ErrorVariance suffix:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 599, 599, 100, 600, 600, 600]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_misspelled_variance.nc
          interpolation:
          - name: air_pressure@MetaData
            method: greatest lower bound
          - name: station_id@MetaData
            method: exact
  expectExceptionWithMessage: "No payload variable found: no variable name begins with 'ErrorVariance/' or ends with '@ErrorVariance'"
Assign observation error from NetCDF file; multiple variables with the @ErrorVariance suffix:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2, 3 ]
        lons: [ 178, 179, 180, 181, 182, 183 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [ 599, 599, 100, 600, 600, 600]
  station_id: [0, 1, 2, 0, 1, 2]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multiple_variances.nc
          interpolation:
          - name: air_pressure@MetaData
            method: greatest lower bound
          - name: station_id@MetaData
            method: exact
  expectExceptionWithMessage: "Multiple payload candidates found: more than one variable name begins with 'ErrorVariance/' or ends with '@ErrorVariance'"
Assign observation error from NetCDF file; 2D array of full covariance matrices:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  channel_number:    [ 2, 0, 4, 7, 5 ]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_4d.nc
          interpolation:
          - name: channel_number@MetaData
            method: exact
  expectExceptionWithMessage: Expecting 3D or 2D array for error covariance
Assign observation error from NetCDF variance; multi-channel variable support:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [brightness_temperature]
    channels: &all_channels 1-2
    generate:
      list:
        lats: [ -2, -1, 0, 1, 2 ]
        lons: [ 178, 179, 180, 181, 182 ]
        dateTimes: [ 0, 3600, 7200,
                     10800, 14400 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0, 1.0]
  satellite_id:      [ 0, 0,  1, 1,  1 ]
  processing_center: [ 0, 1,  0, 1,  0 ]
  latitude_band:     [ 6, 11, 4, 30, 7 ]
  ObsError assign:
    filter variables:
    - name: brightness_temperature
      channels: *all_channels
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        channels: *all_channels
        options:
          channels: *all_channels
          file: Data/ufo/testinput_tier_1/obserror_multi_variant_with_extract_fullr.nc
          interpolation:
          - name: satellite_id@MetaData
            method: exact
          - name: processing_center@MetaData
            method: exact
          - name: latitude_band@MetaData
            method: nearest
#  python-iris debug command: et = cube[2, 2, 5]; meta=[f"{coord.name()}: {coord.points[0]}" for coord in et.coords()]; print(f"data={et.data} {meta}")
#  data[1,1,0]=871   ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 0', 'latitude_band@MetaData: 5', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 0']
#  data[1,1,3]=431   ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 3', 'latitude_band@MetaData: 15', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 0']
#  data[1,1,4]=83    ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 4', 'latitude_band@MetaData: 3', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
#  data[1,1,7]=399   ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 7', 'latitude_band@MetaData: 46', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 1']
#  data[1,1,5]=92    ['channel_number: 1', 'channel_number@MetaData: 1', 'index: 5', 'latitude_band@MetaData: 8', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
#  data[2,2,0]=87.0  ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 0', 'latitude_band@MetaData: 5', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 0']
#  data[2,2,3]=12.0  ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 3', 'latitude_band@MetaData: 15', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 0']
#  data[2,2,4]=771.0 ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 4', 'latitude_band@MetaData: 3', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
#  data[2,2,7]=33.0  ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 7', 'latitude_band@MetaData: 46', 'processing_center@MetaData: 1', 'satellite_id@MetaData: 1']
#  data[2,2,5]=308.0 ['channel_number: 2', 'channel_number@MetaData: 2', 'index: 5', 'latitude_band@MetaData: 8', 'processing_center@MetaData: 0', 'satellite_id@MetaData: 1']
  expected_obserror_variance: [871, 431, 83, 399, 92, 87, 12, 771, 33, 308]

# Tests using the CSV backend

Assign observation error from CSV file; data types float, int and string; payload of type float:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
        lons: [ 31, 59, 31, 59, 31, 59, 31, 59 ]
        dateTimes: [ 0, 0,
                     0, 0,
                     0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [10, 10, 90000, 90000, 10, 10, 90000, 90000]
  StringVar: [south, south, south, south, north, north, north, north]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obsvariance_stringvar_pressure_longitude.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: nearest
          - name: longitude@MetaData
            method: nearest
  expected_obserror_variance: [1, 2, 3, 4, 5, 6, 7, 8]
Assign observation error from CSV file with ioda-v2-style variable names; data types float, int and string; payload of type float:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
        lons: [ 31, 59, 31, 59, 31, 59, 31, 59 ]
        dateTimes: [ 0, 0,
                     0, 0,
                     0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [10, 10, 90000, 90000, 10, 10, 90000, 90000]
  StringVar: [south, south, south, south, north, north, north, north]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_stringvar_pressure_longitude_v2.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: nearest
          - name: longitude@MetaData
            method: nearest
  expected_obserror_variance: [1, 2, 3, 4, 5, 6, 7, 8]
Assign observation error from CSV file; data types float, int and string; payload of type float; strings containing spaces:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
        lons: [ 31, 59, 31, 59, 31, 59, 31, 59 ]
        dateTimes: [ 0, 0,
                     0, 0,
                     0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [10, 10, 90000, 90000, 10, 10, 90000, 90000]
  StringVar: ["South America", "South America", "South America", "South America",
              "North America", "North America", "North America", "North America"]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_spaces_in_stringvar.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: nearest
          - name: longitude@MetaData
            method: nearest
  expected_obserror_variance: [1, 2, 3, 4, 5, 6, 7, 8]
Assign observation error from CSV file; data type datetime; payload of type int:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 0, 0, 0, 0 ]
        lons: [ 0, 0, 0, 0 ]
        dateTimes: [ 28857600, 28944000,
                     216000, 259200 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_datetime.csv
          interpolation:
          - name: dateTime@MetaData
            method: exact
  expected_obserror_variance: [3, 4, 1, 2]
Assign observation error from CSV file; data types float, int and string; missing values:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
        lons: [ 30, 60, 30, 60, 30, 60, 30, 60 ]
        dateTimes: [ 0, 0,
                     0, 0,
                     0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1000, 1000, 100000, 100000, 1000, 1000, 100000, 100000]
  StringVar: [south, south, south, south, north, north, north, north]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_stringvar_pressure_longitude_missing_values.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: exact
          - name: longitude@MetaData
            method: exact
  expected_obserror_variance: [1, 2, 3, 4, 5, 6, 7, 8]
Assign observation error from CSV file; no column with @ErrorVariance suffix:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_misspelled_variance.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: "No payload column found: no column name begins with 'ErrorVariance/' or ends with '@ErrorVariance'"
Assign observation error from CSV file; multiple columns with @ErrorVariance suffix:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_multiple_variances.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: "Multiple payload candidates found: more than one column name begins with 'ErrorVariance/' or ends with '@ErrorVariance'"
Assign observation error from CSV file; string data in column with @ErrorVariance suffix:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_string_variance.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: The payload column must contain numeric data
Assign observation error from CSV file; datetime data in column with @ErrorVariance suffix:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_datetime_variance.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: The payload column must contain numeric data
Assign observation error from CSV file; empty file:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_empty.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: No data could be loaded from the file
Assign observation error from CSV file; only one header line:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_no_data_types.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: No data could be loaded from the file
Assign observation error from CSV file; no data lines:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_no_data_lines.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: No data could be loaded from the file
Assign observation error from CSV file; empty data line:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_empty_data_line.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: No data could be loaded from the file
Assign observation error from CSV file; incorrect number of data types:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_incorrect_num_entries_in_line_2.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: The number of columns in line 2 differs from that in line 1
Assign observation error from CSV file; incorrect number of columns in the first data line:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_incorrect_num_entries_in_line_3.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: The number of columns in line 3 differs from that in line 1
Assign observation error from CSV file; unsupported data type:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 1 ]
        lons: [ 1 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1]
  StringVar: [abc]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_unsupported_data_type.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: Unsupported data type 'color'
Assign observation error from CSV file; criteria insufficient to identify a unique matching row:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ 0 ]
        lons: [ 0 ]
        dateTimes: [ 0 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [100000]
  StringVar: [south]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obsvariance_stringvar_pressure_longitude.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
  expectExceptionWithMessage: Extraction criteria were not sufficient to identify a unique match in the interpolation array
Assign observation error from CSV file; data types float, int and string; missing values:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
        lons: [ 30, 60, 30, 60, 30, 60, 30, 60 ]
        dateTimes: [ 0, 0,
                     0, 0,
                     0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [1000, 1000, 100000, 100000, 1000, 1000, 100000, 100000]
  StringVar: [south, south, south, south, north, north, north, north]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_stringvar_pressure_longitude_missing_values.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: exact
          - name: longitude@MetaData
            method: exact
  expected_obserror_variance: [1, 2, 3, 4, 5, 6, 7, 8]

# Tests using the CSV backend to extract errors instead of variances

Assign observation error from CSV file containing errors; data types float, int and string; payload of type float:
  window begin: 2000-01-01T00:00:00Z
  window end: 2030-01-01T00:00:00Z
  obs space:
    name: Aircraft
    simulated variables: [air_temperature]
    generate:
      list:
        lats: [ -10, -10, -10, -10, 10, 10, 10, 10 ]
        lons: [ 31, 59, 31, 59, 31, 59, 31, 59 ]
        dateTimes: [ 0, 0,
                     0, 0,
                     0, 0,
                     0, 3600 ]
        epoch: "seconds since 2010-01-01T00:00:00Z"
      obs errors: [1.0]
  air_pressure: [10, 10, 90000, 90000, 10, 10, 90000, 90000]
  StringVar: [south, south, south, south, north, north, north, north]
  ObsError assign:
    filter variables:
    - name: air_temperature
    action:
      name: assign error
      error function:
        name: DrawObsErrorFromFile@ObsFunction
        options:
          file: Data/ufo/testinput_tier_1/obserror_stringvar_pressure_longitude.csv
          interpolation:
          - name: StringVar@MetaData
            method: exact
          - name: air_pressure@MetaData
            method: nearest
          - name: longitude@MetaData
            method: nearest
          group: Error
          dispersion measure: standard deviation
  expected_obserror: [1, 2, 3, 4, 5, 6, 7, 8]
